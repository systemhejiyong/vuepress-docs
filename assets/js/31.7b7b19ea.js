(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{193:function(t,e,n){"use strict";n.r(e);var i=n(0),s=Object(i.a)({},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"content"},[t._m(0),t._v(" "),n("p",[t._v("ä½¿ç”¨SPA+.NET Core3.1å®ç° GitHubç¬¬ä¸‰æ–¹æˆæƒç™»å½• ç±»ä¼¼ä½¿ç”¨AspNet.Security.OAuth.GitHubï¼Œå‰ç«¯ä½¿ç”¨å¦‚ä¸‹ï¼šVUE+Vue-Router+axios")]),t._v(" "),t._m(1),t._v(" "),n("ul",[n("li",[t._v("GitHub "),n("a",{attrs:{href:"https://github.com/aspnet-contrib/AspNet.Security.OAuth.Providers",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/aspnet-contrib/AspNet.Security.OAuth.Providers"),n("OutboundLink")],1)])]),t._v(" "),t._m(2),t._v(" "),n("p",[t._v("ä»€ä¹ˆé…ç½®çš„è¿‡ç¨‹ä¸è¯´äº†ã€‚ã€‚æœ‰ä¸€æ¨ã€‚")]),t._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://www.jianshu.com/p/78d186aeb526",target:"_blank",rel:"noopener noreferrer"}},[t._v("GitHub ç¬¬ä¸‰æ–¹ç™»å½•"),n("OutboundLink")],1)]),t._v(" "),n("li",[n("a",{attrs:{href:"https://juejin.im/post/5dfb04cee51d45583a66c2f3",target:"_blank",rel:"noopener noreferrer"}},[t._v("ç»™ä½ çš„ç½‘ç«™æ·»åŠ ç¬¬ä¸‰æ–¹ç™»å½•ä»¥åŠçŸ­ä¿¡éªŒè¯åŠŸèƒ½"),n("OutboundLink")],1)])]),t._v(" "),n("p",[t._v("ä¸‹é¢ä¸ºç¤ºä¾‹")]),t._v(" "),t._m(3),n("p",[t._v("Get")]),t._v(" "),t._m(4),n("p",[t._v("ä¼šé‡å®šå‘åˆ°")]),t._v(" "),n("p",[n("a",{attrs:{href:"https://localhost:5001/signin-github?code=07537a84d12bbae08361",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://localhost:5001/signin-github?code=07537a84d12bbae08361"),n("OutboundLink")],1)]),t._v(" "),n("p",[t._v("è¿™ä¸ªcodeæ”¾åˆ°ä¸‹é¢çš„è¯·æ±‚ä¸­ï¼Œè·å–access_token\nPOSTæ–¹å¼ï¼ˆPostManå»è¯·æ±‚ï¼‰")]),t._v(" "),t._m(5),n("p",[t._v("Getæ–¹å¼")]),t._v(" "),t._m(6),n("p",[t._v("ç„¶åå°±èƒ½è·å–ç”¨æˆ·ä¿¡æ¯")]),t._v(" "),t._m(7),t._m(8),t._v(" "),n("p",[t._v("ä»¥ä¸‹ä»£ç ä¸ºä¸»è¦ä»£ç ï¼Œå®Œæ•´ä»£ç çœ‹ä¸‹é¢çš„DEMOé“¾æ¥ã€‚")]),t._v(" "),n("p",[t._v("ä½¿ç”¨WebApiæ—¶ï¼Œçœ‹äº†ä¸€äº›é¡¹ç›®ï¼Œå…¨æ˜¯åŸºäºMVCç»“æ„çš„ï¼Œéƒ½ä¸æ˜¯æˆ‘æƒ³è¦çš„ã€‚çœ‹äº†ä¸€äº›åšå®¢ä¸Šé¢ä»‹ç» ,æ­¥éª¤éƒ½æ˜¯åƒç¯‡ä¸€å¾‹ï¼Œéƒ½æ˜¯é…åˆå‰åç«¯åˆ†ç¦»çš„ã€‚")]),t._v(" "),t._m(9),t._v(" "),t._m(10),t._v(" "),n("p",[t._v("æœ¬åœ°æµ‹è¯•æ—¶ï¼ŒgitHubå›è°ƒåœ°å€è®¾ç½® http(s)ğŸ˜•/ip:ç«¯å£/signin-github")]),t._v(" "),t._m(11),t._v(" "),t._m(12),t._v(" "),t._m(13),t._v(" "),t._m(14),t._v(" "),t._m(15),t._v(" "),n("p",[n("a",{attrs:{href:"https://docs.microsoft.com/zh-cn/aspnet/core/security/authentication/social/google-logins?view=aspnetcore-3.1",target:"_blank",rel:"noopener noreferrer"}},[t._v("google-ç™»å½•ï¼Œå¾®è½¯æ–‡æ¡£"),n("OutboundLink")],1),t._v("ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ª"),n("strong",[t._v("æ›´æ”¹é»˜è®¤å›è°ƒ URI")]),t._v(",é€šè¿‡ AddGitHubä¸­çš„CallbackPathå±æ€§é…ç½®ã€‚")]),t._v(" "),n("p",[t._v("ä»‹ç»äº†å›è°ƒåœ°å€åº”é…ç½®signin-google,æ‰€ä»¥è¿™é‡Œåº”è¯¥æ˜¯signin-githubï¼Œä»–æ˜¯å¯ä»¥é…ç½®çš„ï¼Œä¸éœ€è¦è‡ªå·±å†™ç¨‹åºå¤„ç†signin-googleè¿™ä¸ªè·¯ç”±ï¼Œå†…éƒ¨æœ‰ä¸­é—´ä»¶å·²ç»å¤„ç†äº†ã€‚")]),t._v(" "),t._m(16),t._v(" "),n("p",[t._v("å…·ä½“ä¸Šé¢çš„æ ¹æ®codeè·å–access_tokenï¼Œæ ¹æ®access_tokenè·å–ç”¨æˆ·çš„ä¿¡æ¯çš„è¿‡ç¨‹ï¼Œè¿™äº›å¤„ç†çš„è¿‡ç¨‹ï¼Œéƒ½ä¸éœ€è¦æˆ‘ä»¬è‡ªå·±å¤„ç†ã€‚æˆ‘ä»¬å¯ä»¥ç”¨ç›´æ¥è·å–ç”¨æˆ·ä¿¡æ¯ã€‚")]),t._v(" "),t._m(17),t._v(" "),t._m(18),t._v(" "),n("p",[t._v("è¿™ä¸ªurlä¸ºå¦ä¸€ä¸ªè·å–ç”¨æˆ·ä¿¡æ¯çš„è·¯ç”±ï¼Œåªè¦æ‹¼æ¥å¥½åœ°å€å³å¯ã€‚")]),t._v(" "),t._m(19),n("p",[t._v("éœ€è¦æ³¨å…¥")]),t._v(" "),t._m(20),t._m(21),t._v(" "),n("p",[t._v("æ‰“å¼€NuGetåŒ…ç®¡ç†,å®‰è£…åŒ…")]),t._v(" "),t._m(22),n("p",[t._v("appSettings.json")]),t._v(" "),t._m(23),n("p",[t._v("addæ‰©å±•æ–¹æ³•")]),t._v(" "),t._m(24),n("p",[t._v("é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚å¤´åƒï¼Œemailï¼Œæ˜¯æ²¡æœ‰è·å–çš„ã€‚")]),t._v(" "),t._m(25),n("p",[t._v("startup.cs")]),t._v(" "),n("p",[t._v("ConfigureServicesä¸­é…ç½®æ­¤æœåŠ¡")]),t._v(" "),t._m(26),n("p",[t._v("åˆ›å»ºAuthenticationController.cs\nå¢åŠ SignInï¼Œç”¨äºå¤„ç†ç”¨æˆ·æˆæƒæˆåŠŸåï¼Œé‡å®šå›signin-callback,å¹¶å°†å‚æ•°å¸¦å›ã€‚")]),t._v(" "),t._m(27),n("p",[t._v("åœ¨signinæ–¹æ³•ä¸­ï¼Œç”¨æˆ·ç‚¹å‡»æˆæƒåï¼ˆç¬¬ä¸€æ¬¡ï¼‰ï¼Œä¼šæ ¹æ®å…¶ä¼ é€’çš„URLï¼Œé‡å®šå‘åˆ°è¿™ä¸ªåœ°å€ï¼Œsignin-callback,å‚æ•°ä¹Ÿä¼šä¸€åŒæºå¸¦ã€‚providerä¸ºGitHub,redirectUrlä¸ºï¼šhttp://localhost:8081/login-result.")]),t._v(" "),t._m(28),n("p",[t._v("è¿™æ—¶å€™æˆ‘ä»¬èƒ½è·å–ç”¨æˆ·ä¿¡æ¯äº†ã€‚é‚£ä¹ˆå‰ç«¯æ€ä¹ˆåŠå‘¢ã€‚æˆ‘ä»¬å†™ä¸ªæ–¹æ³•ï¼Œè·å–ç”¨æˆ·ä¿¡æ¯ï¼Œçœ‹çœ‹æ•ˆæœã€‚")]),t._v(" "),t._m(29),t._v(" "),t._m(30),n("p",[t._v("æˆ‘è®°å¾—ä¹‹å‰ä¼ Tokenæ—¶ï¼Œåå°æ˜¯å¯ä»¥è¿™æ ·è·å–çš„ã€‚")]),t._v(" "),t._m(31),n("p",[t._v("LoginResult.vueåœ¨createdç”Ÿå‘½å‘¨æœŸä¸­ã€‚éƒ½æ˜¯å¾—åˆ°null")]),t._v(" "),t._m(32),t._m(33),t._v(" "),n("p",[t._v("å› ä¸ºå‰åç«¯åˆ†ç¦»ï¼Œä¸æ˜¯åŸºäºCookiesçš„ã€‚httpæ˜¯æ— çŠ¶æ€çš„ã€‚æ¯æ¬¡è¯·æ±‚æ— æ³•åŒºåˆ†ç”¨æˆ·çš„ã€‚æˆ‘ä»¬å¯ä»¥æ ¹æ®å½“å‰çš„ClaimsPrincipalï¼Œæ ¹æ®JWTç”Ÿæˆç›¸åº”çš„Tokenï¼Œaxiosè¯·æ±‚æ—¶ï¼Œæ”¾åˆ°headersä¸­ã€‚")]),t._v(" "),n("p",[t._v("å®‰è£…åŒ…")]),t._v(" "),t._m(34),n("p",[t._v("AppSettings.jsoné…ç½®æ”¹æˆ")]),t._v(" "),t._m(35),n("p",[t._v("AddJwtConfigurationæ”¹æˆå¦‚ä¸‹å†…å®¹")]),t._v(" "),t._m(36),n("p",[n("a",{attrs:{href:"https://github.com/luoyunchong/dotnetcore-examples/blob/master/dotnetcore3.1/VoVo.AspNetCore.OAuth2/spa-vue-oauth2/src/components/LoginResult.vue",target:"_blank",rel:"noopener noreferrer"}},[t._v("å‰ç«¯LoginResult.vueä»£ç "),n("OutboundLink")],1)]),t._v(" "),n("p",[t._v("å‰ç«¯è¿è¡Œ")]),t._v(" "),t._m(37),n("p",[t._v("ç‚¹å‡»GitHubç™»å½•")]),t._v(" "),n("p",[t._v("GetOpenIdByTokenæ ¹æ®ç”Ÿæˆçš„tokenå€¼ï¼Œè§£æå‡ºäº†ç”¨æˆ·id,è¿™æ ·å‰ç«¯åœ¨login-resultè¿™ä¸ªç»„ä»¶ä¸­ï¼ŒæŠŠtokenä¿å­˜å¥½ï¼Œå¹¶é‡å®šå‘è‡ªå·±çš„ä¸»é¡µï¼Œè·å–ç”¨æˆ·æ‰€æœ‰ä¿¡æ¯å³å¯ã€‚")]),t._v(" "),t._m(38),n("p",[t._v("OpenId?provider=GitHubåˆ™å¾—ä¸åˆ°æ•°æ®ï¼Œåªèƒ½æµè§ˆå™¨ç›´æ¥è¯·æ±‚https://localhost:5001/OpenId?provider=GitHubï¼Œæ‰èƒ½åˆ°github çš„idã€‚è¿™ä¸ªé€‚åº”äºå‰åç«¯ä¸åˆ†ç¦»ï¼Œæˆ–è€…å±äºä¹‹å‰æˆ‘ä»¬ç»å¸¸ä½¿ç”¨MVCç»“æ„ï¼ŒåŒä¸€åŸŸåä¸‹ï¼ŒåŒä¸€ç«¯å£ï¼ŒåŸºäºCookiesç™»å½•çš„åˆ¤æ–­ã€‚")]),t._v(" "),t._m(39),t._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://www.cnblogs.com/rsls/p/10522649.html",target:"_blank",rel:"noopener noreferrer"}},[t._v(".net Core2.2 WebApié€šè¿‡OAuth2.0å®ç°å¾®ä¿¡ç™»å½•"),n("OutboundLink")],1)]),t._v(" "),n("li",[n("a",{attrs:{href:"https://blog.csdn.net/weixin_30414305/article/details/101389325",target:"_blank",rel:"noopener noreferrer"}},[t._v("AspNetCore3.0 å’Œ JWT"),n("OutboundLink")],1)]),t._v(" "),n("li",[n("a",{attrs:{href:"http://www.woshipm.com/pd/509712.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("ç”¨æˆ·ç³»ç»Ÿè®¾è®¡ï¼šç¬¬ä¸‰æ–¹æˆæƒã€è´¦å·ç»‘å®šåŠè§£ç»‘ï¼ˆä¸‹ï¼‰"),n("OutboundLink")],1)])]),t._v(" "),t._m(40),t._v(" "),n("ul",[n("li",[t._v("GitHub "),n("a",{attrs:{href:"https://github.com/luoyunchong/dotnetcore-examples/tree/master/dotnetcore3.1/VoVo.AspNetCore.OAuth2",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/luoyunchong/dotnetcore-examples/tree/master/dotnetcore3.1/VoVo.AspNetCore.OAuth2"),n("OutboundLink")],1),t._v(" "),n("RightMenu")],1)])])},[function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"githubç¬¬ä¸‰æ–¹æˆæƒç™»å½•"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#githubç¬¬ä¸‰æ–¹æˆæƒç™»å½•","aria-hidden":"true"}},[this._v("#")]),this._v(" GitHubç¬¬ä¸‰æ–¹æˆæƒç™»å½•")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"aspnet-security-oauth-github"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#aspnet-security-oauth-github","aria-hidden":"true"}},[this._v("#")]),this._v(" AspNet.Security.OAuth.GitHub")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"githubæˆæƒç™»å½•"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#githubæˆæƒç™»å½•","aria-hidden":"true"}},[this._v("#")]),this._v(" GitHubæˆæƒç™»å½•")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("client_id:0be6b05fc717bfc4fb67\nclient_secret:dcaced9f176afba64e89d88b9b06ffc4a887a609\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("https://github.com/login/oauth/authorize?client_id=0be6b05fc717bfc4fb67&redirect_uri=https://localhost:5001/signin-github\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("https://github.com/login/oauth/access_token?client_id=0be6b05fc717bfc4fb67&client_secret=dcaced9f176afba64e89d88b9b06ffc4a887a609&code=07537a84d12bbae08361\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("https://api.github.com/user?access_token=787506afa3271d077b98f18af56d7cfdc8db43b4\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v('{\n   "login": "luoyunchong",\n   "id": 18613266,\n   "node_id": "MDQ6VXNlcjE4NjEzMjY2",\n   "avatar_url": "https://avatars1.githubusercontent.com/u/18613266?v=4",\n   "gravatar_id": "",\n   "url": "https://api.github.com/users/luoyunchong",\n   "html_url": "https://github.com/luoyunchong",\n   "followers_url": "https://api.github.com/users/luoyunchong/followers",\n   "following_url": "https://api.github.com/users/luoyunchong/following{/other_user}",\n   "gists_url": "https://api.github.com/users/luoyunchong/gists{/gist_id}",\n   "starred_url": "https://api.github.com/users/luoyunchong/starred{/owner}{/repo}",\n   "subscriptions_url": "https://api.github.com/users/luoyunchong/subscriptions",\n   "organizations_url": "https://api.github.com/users/luoyunchong/orgs",\n   "repos_url": "https://api.github.com/users/luoyunchong/repos",\n   "events_url": "https://api.github.com/users/luoyunchong/events{/privacy}",\n   "received_events_url": "https://api.github.com/users/luoyunchong/received_events",\n   "type": "User",\n   "site_admin": false,\n   "name": "IGeekFan",\n   "company": null,\n   "blog": "https://blog.igeekfan.cn",\n   "location": null,\n   "email": "luoyunchong@foxmail.com",\n   "hireable": null,\n   "bio": "å­¦ä¹ ä¹‹è·¯æ¼«æ¼«æ— æœŸã€‚",\n   "public_repos": 14,\n   "public_gists": 0,\n   "followers": 16,\n   "following": 11,\n   "created_at": "2016-04-22T10:33:44Z",\n   "updated_at": "2019-12-21T14:49:33Z"\n}\n')])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"net-core3-1"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#net-core3-1","aria-hidden":"true"}},[this._v("#")]),this._v(" .NET Core3.1")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("å‰ç«¯è¿è¡Œåœ¨:http://localhost:8081")]),this._v(" "),e("li",[this._v("åç«¯è¿è¡Œåœ¨:https://localhost:5001")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"å‰åç«¯åˆ†ç¦»çš„spa-é…åˆç¬¬ä¸‰æ–¹æˆæƒç™»å½•æµç¨‹å¦‚ä¸‹"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#å‰åç«¯åˆ†ç¦»çš„spa-é…åˆç¬¬ä¸‰æ–¹æˆæƒç™»å½•æµç¨‹å¦‚ä¸‹","aria-hidden":"true"}},[this._v("#")]),this._v(" å‰åç«¯åˆ†ç¦»çš„SPA é…åˆç¬¬ä¸‰æ–¹æˆæƒç™»å½•æµç¨‹å¦‚ä¸‹")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("å¦‚: https://localhost:5001/signin-githubã€‚")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"_1-ä¸Šé¢è¿™ä¸ªæ˜æ˜å¡«å†™çš„åç«¯çš„åœ°å€ï¼Œé‚£åç«¯æ€ä¹ˆæŠŠç»“æœé€šçŸ¥å‰ç«¯å‘¢ï¼Ÿ"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-ä¸Šé¢è¿™ä¸ªæ˜æ˜å¡«å†™çš„åç«¯çš„åœ°å€ï¼Œé‚£åç«¯æ€ä¹ˆæŠŠç»“æœé€šçŸ¥å‰ç«¯å‘¢ï¼Ÿ","aria-hidden":"true"}},[this._v("#")]),this._v(" 1. ä¸Šé¢è¿™ä¸ªæ˜æ˜å¡«å†™çš„åç«¯çš„åœ°å€ï¼Œé‚£åç«¯æ€ä¹ˆæŠŠç»“æœé€šçŸ¥å‰ç«¯å‘¢ï¼Ÿ")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("å‰ç«¯è¯·æ±‚"),e("strong",[this._v("https://localhost:5001/signin?provider=GitHub&redirectUrl=http://localhost:8080/login-result")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("æä¾›å‚æ•°providerä¸ºGitHubï¼Œ")]),this._v(" "),e("li",[this._v("redirectUrlä¸ºGitHubæˆæƒç™»å½•åï¼Œå›è°ƒsignin-githubåï¼Œåç«¯å†å»é‡å®šå‘çš„åœ°å€ï¼Œè¿™é‡Œå¡«å‰ç«¯çš„ä¸€ä¸ªè·¯ç”±ã€‚")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"_2-åç«¯åªæä¾›äº†signinï¼Œsignin-callbackè·¯ç”±ï¼Œæ²¡æœ‰signin-githubï¼Œé‚£githubä¸Šé…ç½®çš„è·¯ç”±æ˜¯æ€ä¹ˆå›è°ƒå›æ¥å‘¢ï¼Ÿ"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-åç«¯åªæä¾›äº†signinï¼Œsignin-callbackè·¯ç”±ï¼Œæ²¡æœ‰signin-githubï¼Œé‚£githubä¸Šé…ç½®çš„è·¯ç”±æ˜¯æ€ä¹ˆå›è°ƒå›æ¥å‘¢ï¼Ÿ","aria-hidden":"true"}},[this._v("#")]),this._v(" 2. åç«¯åªæä¾›äº†signinï¼Œsignin-callbackè·¯ç”±ï¼Œæ²¡æœ‰signin-githubï¼Œé‚£githubä¸Šé…ç½®çš„è·¯ç”±æ˜¯æ€ä¹ˆå›è°ƒå›æ¥å‘¢ï¼Ÿ")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"_3-å›è°ƒåˆ°signin-githubåï¼Œåç«¯æ€ä¹ˆå¤„ç†ï¼Œæ‰èƒ½è®©å‰ç«¯åˆ·æ–°ã€‚è·å–ç™»å½•åçš„ä¿¡æ¯å‘¢ã€‚"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-å›è°ƒåˆ°signin-githubåï¼Œåç«¯æ€ä¹ˆå¤„ç†ï¼Œæ‰èƒ½è®©å‰ç«¯åˆ·æ–°ã€‚è·å–ç™»å½•åçš„ä¿¡æ¯å‘¢ã€‚","aria-hidden":"true"}},[this._v("#")]),this._v(" 3. å›è°ƒåˆ°signin-githubåï¼Œåç«¯æ€ä¹ˆå¤„ç†ï¼Œæ‰èƒ½è®©å‰ç«¯åˆ·æ–°ã€‚è·å–ç™»å½•åçš„ä¿¡æ¯å‘¢ã€‚")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("ä¸€ä¸ªæ–¹æ³•SignIn,åªè¦"),e("strong",[this._v("return Challenge(properties, provider);")]),this._v("ï¼Œ")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("provider ä¸º GitHubï¼Œ")]),this._v(" "),e("li",[this._v("properties  var properties = new AuthenticationProperties { RedirectUri = url };")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("var authenticateResult = await _contextAccessor.HttpContext.AuthenticateAsync(provider);\nstring email = authenticateResult.Principal.FindFirst(ClaimTypes.Email)?.Value;\nstring name = authenticateResult.Principal.FindFirst(ClaimTypes.Name)?.Value;\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("private readonly IHttpContextAccessor _contextAccessor;\npublic AuthenticationController( IHttpContextAccessor contextAccessor)\n{\n    _contextAccessor = contextAccessor;\n}\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"ä»£ç éƒ¨ç½²ï¼ˆç®€åŒ–ï¼‰"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ä»£ç éƒ¨ç½²ï¼ˆç®€åŒ–ï¼‰","aria-hidden":"true"}},[this._v("#")]),this._v(" ä»£ç éƒ¨ç½²ï¼ˆç®€åŒ–ï¼‰")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("Install-Package AspNet.Security.OAuth.GitHub\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v('"Authentication": {\n    "GitHub": {\n      "ClientId": "0be6b05fc717bfc4fb67",\n      "ClientSecret": "dcaced9f176afba64e89d88b9b06ffc4a887a609"\n    }\n}\n')])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v('public static class JwtConfiguration\n{\n    public static void AddJwtConfiguration(this IServiceCollection services, IConfiguration configuration)\n    {\n\n        services.AddAuthentication(opts =>\n            {\n                opts.DefaultScheme = CookieAuthenticationDefaults.AuthenticationScheme;\n                opts.DefaultAuthenticateScheme = JwtBearerDefaults.AuthenticationScheme;\n            }).AddCookie(options =>\n        {\n            options.LoginPath = "/signin";\n            options.LogoutPath = "/signout";\n        }).AddGitHub(options =>\n        {\n            options.ClientId = configuration["Authentication:GitHub:ClientId"];\n            options.ClientSecret = configuration["Authentication:GitHub:ClientSecret"];\n        });\n    }\n}\n')])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v('.AddGitHub(options =>\n{\n    options.ClientId = configuration["Authentication:GitHub:ClientId"];\n    options.ClientSecret = configuration["Authentication:GitHub:ClientSecret"];\n    //options.CallbackPath = new PathString("~/signin-github");//ä¸GitHubä¸Šçš„å›è°ƒåœ°å€ç›¸åŒï¼Œé»˜è®¤å³æ˜¯/signin-github\n    options.Scope.Add("user:email");\n    //authenticateResult.Principal.FindFirst(LinConsts.Claims.AvatarUrl)?.Value;  å¾—åˆ°GitHubå¤´åƒ\n    options.ClaimActions.MapJsonKey(LinConsts.Claims.AvatarUrl, "avatar_url");\n    options.ClaimActions.MapJsonKey(LinConsts.Claims.BIO, "bio");\n    options.ClaimActions.MapJsonKey(LinConsts.Claims.BlogAddress, "blog");\n});\n\n#å…¶ä¸­LinConstsç±»ä¸ºé™æ€å¸¸é‡\npublic static class LinConsts\n{\n    public static class Claims\n    {\n        public const string BIO = "urn:github:bio";\n        public const string AvatarUrl = "urn:github:avatar_url";\n        public const string BlogAddress = "urn:github:blog";\n    }\n}\n')])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("    services.AddSingleton<IHttpContextAccessor, HttpContextAccessor>();\n    services.AddJwtConfiguration(Configuration);\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v('        private readonly IHttpContextAccessor _contextAccessor;\n        private readonly IConfiguration _configuration;\n\n        public AuthenticationController(IHttpContextAccessor contextAccessor, IConfiguration configuration)\n        {\n            _contextAccessor = contextAccessor;\n            _configuration = configuration;\n        }\n        \n        [HttpGet("~/signin")]\n        public async Task<IActionResult> SignIn(string provider, string redirectUrl)\n        {\n            var request = _contextAccessor.HttpContext.Request;\n            var url =\n                $"{request.Scheme}://{request.Host}{request.PathBase}{request.Path}-callback?provider={provider}&redirectUrl={redirectUrl}";\n            var properties = new AuthenticationProperties { RedirectUri = url };\n            properties.Items["LoginProviderKey"] = provider;\n            return Challenge(properties, provider);\n\n        }\n')])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v('[HttpGet("~/signin-callback")]\npublic async Task<IActionResult> Home(string provider = null, string redirectUrl = "")\n{\n    var authenticateResult = await _contextAccessor.HttpContext.AuthenticateAsync(provider);\n    if (!authenticateResult.Succeeded) return Redirect(redirectUrl);\n    var openIdClaim = authenticateResult.Principal.FindFirst(ClaimTypes.NameIdentifier);\n    if (openIdClaim == null || string.IsNullOrWhiteSpace(openIdClaim.Value))\n        return Redirect(redirectUrl);\n\n    //TODO è®°å½•æˆæƒæˆåŠŸåçš„ä¿¡æ¯ \n\n    string email = authenticateResult.Principal.FindFirst(ClaimTypes.Email)?.Value;\n    string name = authenticateResult.Principal.FindFirst(ClaimTypes.Name)?.Value;\n    string gitHubName = authenticateResult.Principal.FindFirst(GitHubAuthenticationConstants.Claims.Name)?.Value;\n    string gitHubUrl = authenticateResult.Principal.FindFirst(GitHubAuthenticationConstants.Claims.Url)?.Value;\n    //startup ä¸­ AddGitHubé…ç½®é¡¹  options.ClaimActions.MapJsonKey(LinConsts.Claims.AvatarUrl, "avatar_url");\n    string avatarUrl = authenticateResult.Principal.FindFirst(LinConsts.Claims.AvatarUrl)?.Value;\n\n    return Redirect($"{redirectUrl}?openId={openIdClaim.Value}");\n}\n')])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("æµè§ˆå™¨ç›´æ¥æ‰“å¼€èƒ½å¾—åˆ°githubçš„idã€‚")]),this._v(" "),e("li",[this._v("axios GETè¯·æ±‚ https://localhost:5001/OpenId å¾—åˆ°null")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v('[HttpGet("~/OpenId")]\npublic async Task<string> OpenId(string provider = null)\n{\n   var authenticateResult = await _contextAccessor.HttpContext.AuthenticateAsync(provider);\n   if (!authenticateResult.Succeeded) return null;\n   var openIdClaim = authenticateResult.Principal.FindFirst(ClaimTypes.NameIdentifier);\n   return openIdClaim?.Value;\n}\n')])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v('[HttpGet("~/GetOpenIdByToken")]\npublic string GetOpenIdByToken()\n{\n    return User.FindFirst(ClaimTypes.NameIdentifier)?.Value;\n}\n')])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v('axios({\n  methods: "get",\n  url: "https://localhost:5001/OpenId?provider=GitHub"\n})\n  .then(function(response) {\n    // handle success\n    console.log(response);\n  })\n\naxios({\n  methods: "get",\n  url: "https://localhost:5001/GetOpenIdByToken"\n})\n  .then(function(response) {\n    // handle success\n    console.log(response);\n  })\n')])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"ä¸ºä»€ä¹ˆå‘¢ï¼Ÿï¼Ÿï¼Ÿ"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ä¸ºä»€ä¹ˆå‘¢ï¼Ÿï¼Ÿï¼Ÿ","aria-hidden":"true"}},[this._v("#")]),this._v(" ä¸ºä»€ä¹ˆå‘¢ï¼Ÿï¼Ÿï¼Ÿ")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("Install-Package Microsoft.AspNetCore.Authentication.JwtBearer\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v('"Authentication": {\n"JwtBearer": {\n  "SecurityKey": "JWTStudyWebsite_DI20DXU3",\n  "Issuer": "JWTStudy",\n  "Audience": "JWTStudyWebsite"\n},\n"GitHub": {\n  "ClientId": "0be6b05fc717bfc4fb67",\n  "ClientSecret": "dcaced9f176afba64e89d88b9b06ffc4a887a609"\n}\n}\n')])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v('public static void AddJwtConfiguration(this IServiceCollection services, IConfiguration configuration)\n{\n\n    services.AddAuthentication(opts =>\n        {\n            opts.DefaultScheme = CookieAuthenticationDefaults.AuthenticationScheme;\n            opts.DefaultAuthenticateScheme = JwtBearerDefaults.AuthenticationScheme;\n        }).AddCookie(options =>\n    {\n        options.LoginPath = "/signin";\n        options.LogoutPath = "/signout";\n    }).AddJwtBearer(JwtBearerDefaults.AuthenticationScheme, options =>\n    {\n        options.Audience = configuration["Authentication:JwtBearer:Audience"];\n\n        options.TokenValidationParameters = new TokenValidationParameters\n        {\n            // The signing key must match!\n            ValidateIssuerSigningKey = true,\n            IssuerSigningKey = new SymmetricSecurityKey(\n                Encoding.ASCII.GetBytes(configuration["Authentication:JwtBearer:SecurityKey"])),\n\n            // Validate the JWT Issuer (iss) claim\n            ValidateIssuer = true,\n            ValidIssuer = configuration["Authentication:JwtBearer:Issuer"],\n\n            // Validate the JWT Audience (aud) claim\n            ValidateAudience = true,\n            ValidAudience = configuration["Authentication:JwtBearer:Audience"],\n\n            // Validate the token expiry\n            ValidateLifetime = true,\n\n            // If you want to allow a certain amount of clock drift, set that here\n            //ClockSkew = TimeSpan.Zero\n        };\n    }).AddGitHub(options =>\n    {\n        options.ClientId = configuration["Authentication:GitHub:ClientId"];\n        options.ClientSecret = configuration["Authentication:GitHub:ClientSecret"];\n        //options.CallbackPath = new PathString("~/signin-github");//ä¸GitHubä¸Šçš„å›è°ƒåœ°å€ç›¸åŒï¼Œé»˜è®¤å³æ˜¯/signin-github\n        options.Scope.Add("user:email");\n        //authenticateResult.Principal.FindFirst(LinConsts.Claims.AvatarUrl)?.Value;  å¾—åˆ°GitHubå¤´åƒ\n        options.ClaimActions.MapJsonKey(LinConsts.Claims.AvatarUrl, "avatar_url");\n        options.ClaimActions.MapJsonKey(LinConsts.Claims.BIO, "bio");\n        options.ClaimActions.MapJsonKey(LinConsts.Claims.BlogAddress, "blog");\n    });\n}\n')])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("yarn install\nyarn serve\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v('data: 18613266\nstatus: 200\nconfig: {url: "https://localhost:5001/GetOpenIdByToken"}\n')])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"å‚è€ƒ"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#å‚è€ƒ","aria-hidden":"true"}},[this._v("#")]),this._v(" å‚è€ƒ")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"demo-ç¤ºä¾‹"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#demo-ç¤ºä¾‹","aria-hidden":"true"}},[this._v("#")]),this._v(" Demo  ç¤ºä¾‹")])}],!1,null,null,null);e.default=s.exports}}]);