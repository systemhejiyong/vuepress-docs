(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{177:function(t,e,n){"use strict";n.r(e);var r=n(0),a=Object(r.a)({},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"content"},[t._m(0),t._v(" "),n("p",[t._v(".NET Core下集成 七牛云下的对象存储")]),t._v(" "),t._m(1),t._v(" "),n("p",[n("a",{attrs:{href:"https://github.com/luoyunchong/dotnetcore-examples/tree/master/asp.net-core-qiniu",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/luoyunchong/dotnetcore-examples/tree/master/asp.net-core-qiniu"),n("OutboundLink")],1)]),t._v(" "),t._m(2),t._v(" "),n("table",[t._m(3),t._v(" "),n("tbody",[n("tr",[n("td",[n("a",{attrs:{href:"https://github.com/luoyunchong/dotnetcore-examples/tree/master/dotnet-core-efcore",target:"_blank",rel:"noopener noreferrer"}},[t._v("Qiniu云对象存储"),n("OutboundLink")],1)]),t._v(" "),n("td",[n("a",{attrs:{href:"https://github.com/qiniu/csharp-sdk",target:"_blank",rel:"noopener noreferrer"}},[t._v(".net"),n("OutboundLink")],1),t._v("/"),n("a",{attrs:{href:"https://github.com/Hello-Mango/MQiniu.Core",target:"_blank",rel:"noopener noreferrer"}},[t._v(".net core"),n("OutboundLink")],1)]),t._v(" "),n("td",[n("a",{attrs:{href:"https://developer.qiniu.com/kodo/sdk/1237/csharp",target:"_blank",rel:"noopener noreferrer"}},[t._v("c# sdk"),n("OutboundLink")],1)]),t._v(" "),n("td",[t._v("由于官网未支持. net core，所以 大家看"),n("a",{attrs:{href:"https://github.com/Hello-Mango/MQiniu.Core",target:"_blank",rel:"noopener noreferrer"}},[t._v("社区版解决方案"),n("OutboundLink")],1)])])])]),t._v(" "),t._m(4),t._v(" "),t._m(5),t._v(" "),t._m(6),t._v(" "),n("p",[t._v("在七牛云中自行注册后，在个人中心，密钥管理，生成自己的密钥（https://portal.qiniu.com/user/key）\nv* AK，SK分别代表：AccessKey/SecretKey")]),t._v(" "),t._m(7),t._v(" "),t._m(8),t._v(" "),t._m(9),t._m(10),t._v(" "),t._m(11),t._m(12),t._v(" "),n("p",[t._v("配置swagger的过程就不说了，创建QiniuController")]),t._v(" "),t._m(13),n("p",[t._v("Upload方法中，Zone.ZONE_CN_South，代表华南，所以创建对象存储时要注意，请选择与此相同的位置（华南），或根据实际情况修改Zone所在地区的枚举值即可。")]),t._v(" "),t._m(14),t._m(15),t._v(" "),n("p",[t._v("双击 publish.bat，生成的文件夹为如下：")]),t._v(" "),t._m(16),t._v(" "),t._m(17),t._v(" "),n("p",[t._v("使用xshell远程登录后，进入root权限。")]),t._v(" "),t._m(18),n("p",[t._v("前置条件，在ubuntu上安装好了docker。并且正常运行。")]),t._v(" "),n("p",[t._v("-d 代表后台运行，此时将对外显露5000端口运行，5000是运行后，docker对外的端口，80是这个服务对外的端口，其中Dockerfile 存在语句EXPOSE 80")]),t._v(" "),t._m(19),n("p",[t._v("此时打开 浏览器， ip+端口5000即可访问服务，请加/swagger。")]),t._v(" "),n("p",[t._v("本项目已部署至服务器 "),n("a",{attrs:{href:"http://122.152.192.161:5000/swagger/index.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://122.152.192.161:5000/swagger/index.html"),n("OutboundLink")],1)]),t._v(" "),t._m(20),t._v(" "),t._m(21),t._v(" "),t._m(22),t._v(" "),n("ul",[n("li",[t._v(".NET Core版本七牛云SDK使用"),n("a",{attrs:{href:"https://www.cnblogs.com/OMango/p/8447480.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://www.cnblogs.com/OMango/p/8447480.html"),n("OutboundLink")],1)]),t._v(" "),n("li",[t._v(".NET Core部署至Linux 下的Docker "),n("a",{attrs:{href:"http://blog.igeekfan.cn/2019/06/09/dotnetcore/ASP.NET-Core-Deploy-To-Docker-Ubuntu/",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://blog.igeekfan.cn/2019/06/09/dotnetcore/ASP.NET-Core-Deploy-To-Docker-Ubuntu/"),n("OutboundLink")],1)])]),t._v(" "),n("RightMenu")],1)},[function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"七牛云对象存储"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#七牛云对象存储","aria-hidden":"true"}},[this._v("#")]),this._v(" 七牛云对象存储")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"开源地址"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#开源地址","aria-hidden":"true"}},[this._v("#")]),this._v(" 开源地址")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"集成类库"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#集成类库","aria-hidden":"true"}},[this._v("#")]),this._v(" 集成类库")])},function(){var t=this.$createElement,e=this._self._c||t;return e("thead",[e("tr",[e("th",[this._v("基础类库集成方案")]),this._v(" "),e("th",[this._v("开源地址")]),this._v(" "),e("th",[this._v("文档")]),this._v(" "),e("th",[this._v("说明")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"前提"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#前提","aria-hidden":"true"}},[this._v("#")]),this._v(" 前提")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("本地windows 10,安装 .net core 2.2+")]),this._v(" "),e("li",[this._v("Linux 服务器 Ubuntu Server 16+")]),this._v(" "),e("li",[this._v("服务器安装了Docker")]),this._v(" "),e("li",[this._v("本地xftp、xshell（这二个分别是windows传文件至linux，执行命令行。）")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"准备"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#准备","aria-hidden":"true"}},[this._v("#")]),this._v(" 准备")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("Bucket中的vant-ui，是创建对象存储时起的名字")]),this._v(" "),e("li",[this._v("PrefixPath中的值，随意字符串，前缀地址。")]),this._v(" "),e("li",[this._v("Host为：融合 CDN 测试域名,可自行绑定自己的域名，否则只有三十天免费使用时长。")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"appsettings-json配置项"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#appsettings-json配置项","aria-hidden":"true"}},[this._v("#")]),this._v(" appsettings.json配置项")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v('  "Qiniu": {\n    "AK": "eUH1O-ft66S4XM2GIK7FGmj7czuYkcAyNGDAc-wq",\n    "SK": "4dOi1daSr2-YgofhAfWb8JaLrbgozCmgD6AUmmM9",\n    "Bucket": "vant-ui",\n    "PrefixPath": "ui",\n    "Host": "http://pu5vnz60k.bkt.clouddn.com/"\n  }\n')])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"安装包"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装包","aria-hidden":"true"}},[this._v("#")]),this._v(" 安装包")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("Install-Package MQiniu.Core \n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"代码解读"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#代码解读","aria-hidden":"true"}},[this._v("#")]),this._v(" 代码解读")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v('  /// <summary>\n    /// 七牛云上传服务\n    /// </summary>\n    [Route("api/[controller]")]\n    [ApiController]\n    public class QiniuController : ControllerBase\n    {\n        private readonly IConfiguration _configuration;\n\n        public QiniuController(IConfiguration configuration)\n        {\n            _configuration = configuration;\n        }\n\n        /// <summary>\n        /// 根据后台配置项，得到请求七牛云的token值，前台也可根据此token值上传至七牛云服务\n        /// </summary>\n        /// <returns></returns>\n        [HttpGet("access_token")]\n        public string GetAccessToken()\n        {\n            Mac mac = new Mac(_configuration["Qiniu:AK"], _configuration["Qiniu:SK"]);\n            PutPolicy putPolicy = new PutPolicy { Scope = _configuration["Qiniu:Bucket"] };\n            return Auth.CreateUploadToken(mac, putPolicy.ToJsonString());\n        }\n\n        /// <summary>\n        /// 上传文件至七牛云,code为200，代表上传成功,其他代表不成功\n        /// </summary>\n        /// <param name="file">单个文件</param>\n        /// <returns>new { code = 200, data ="七牛云文件地址，包括http://....mm.png", msg = "上传成功" };</returns>\n        [HttpPost("upload")]\n        public dynamic Upload(IFormFile file)\n        {\n            if (file.Length == 0)\n            {\n                return new { code = 1, msg = "文件为空" };\n            }\n\n            FormUploader upload = new FormUploader(new Config()\n            {\n                Zone = Zone.ZONE_CN_South,//华南 \n                UseHttps = true\n            });\n\n            var fileName = ContentDispositionHeaderValue\n                .Parse(file.ContentDisposition)\n                .FileName.Trim();\n\n            string qiniuName = _configuration["Qiniu:PrefixPath"] + "/" + DateTime.Now.ToString("yyyyMMddHHmmssffffff") + fileName;\n            Stream stream = file.OpenReadStream();\n            HttpResult result = upload.UploadStream(stream, qiniuName, GetAccessToken(), null);\n\n            if (result.Code == 200)\n            {\n                return new { code = 200, data = _configuration["Qiniu:Host"] + qiniuName, msg = "上传成功" };\n            }\n\n            return new { code = 1, msg = "上传失败" };\n        }\n    }\n\n')])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("FormUploader upload = new FormUploader(new Config()\n{\n    Zone = Zone.ZONE_CN_South,//华南 \n    UseHttps = true\n});\n\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"发布至linux下的docker"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#发布至linux下的docker","aria-hidden":"true"}},[this._v("#")]),this._v(" 发布至Linux下的Docker")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("img",{attrs:{src:"https://upload-images.jianshu.io/upload_images/2001974-bcd72707e4fcc7f8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240",alt:"image"}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("修改项目名为qiniu-web，复制 至linux服务器中，（xftp工具）\n"),e("img",{attrs:{src:"https://upload-images.jianshu.io/upload_images/2001974-48771e9fce281262.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240",alt:"image"}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[this._v("root@VM-37-104-ubuntu:/home/ubuntu/"),e("span",{pre:!0,attrs:{class:"token comment"}},[this._v("# sudo su")]),this._v("\nroot@VM-37-104-ubuntu:/home/ubuntu/"),e("span",{pre:!0,attrs:{class:"token comment"}},[this._v("# cd qiniu-web")]),this._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[this._v("docker build -t igeekfan/qiniu "),e("span",{pre:!0,attrs:{class:"token keyword"}},[this._v(".")]),this._v("     "),e("span",{pre:!0,attrs:{class:"token comment"}},[this._v("#生成images")]),this._v("\ndocker run -d -p 5000:80 igeekfan/qiniu  "),e("span",{pre:!0,attrs:{class:"token comment"}},[this._v("# 生成 container 并运行在5000端口")]),this._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"运行结果"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#运行结果","aria-hidden":"true"}},[this._v("#")]),this._v(" 运行结果")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("img",{attrs:{src:"https://upload-images.jianshu.io/upload_images/2001974-2b72cc6338db1434.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240",alt:"image.png"}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"参考"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#参考","aria-hidden":"true"}},[this._v("#")]),this._v(" 参考")])}],!1,null,null,null);e.default=a.exports}}]);